---
layout: page
title: Prompt Generator Test Report
permalink: /prompt-tester-report/
---

<h1>📊 Prompt Generator Automated Test Report</h1>
<p>This page runs the full test library and generates a Markdown summary of all results for documentation or regression tracking.</p>

<div style="margin-top:20px;">
  <button id="runTestsBtn" style="padding:10px 20px;font-weight:600;">▶️ Run Tests</button>
  <button id="downloadBtn" style="padding:10px 20px;font-weight:600; margin-left:10px;" disabled>💾 Download Report</button>
</div>

<pre id="output" style="margin-top:20px; background:#f9f9f9; border:1px solid #ddd; border-radius:8px; padding:20px; white-space:pre-wrap; font-family:monospace;"></pre>

<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
<script src="{{ '/assets/js/prompt-generator.js' | relative_url }}"></script>

<script>
async function runTests() {
  const runBtn = document.getElementById('runTestsBtn');
  const out = document.getElementById('output');
  const dlBtn = document.getElementById('downloadBtn');
  runBtn.disabled = true;
  out.textContent = "Running tests...";
  const res = await fetch('/prompt-tests-extended.yaml');
  const yaml = await res.text();
  const tests = jsyaml.load(yaml);

  let passCount = 0;
  let failCount = 0;
  const reportLines = ["# 🧪 Prompt Generator Automated Test Report\n"];
  const now = new Date().toLocaleString();
  reportLines.push(`_Generated: ${now}_\n`);

  for (const t of tests) {
    const fails = [];
    let patterns, prompt;

    try {
      patterns = PatternAnalyzer.analyze(t.input);

      if (t.expected_error) {
        if (patterns.error && patterns.error.includes(t.expected_error)) {
          reportLines.push(`✅ **${t.name}** — expected error matched`);
          passCount++;
          continue;
        } else {
          fails.push(`Expected error: \`${t.expected_error}\` but got \`${patterns.error || 'none'}\``);
        }
      } else if (t.expected) {
        for (const [path, expected] of Object.entries(t.expected)) {
          const actual = path.split('.').reduce((o, i) => o && o[i], patterns);
          if (actual !== expected) {
            fails.push(`❌ \`${path}\`: expected **${expected}**, got **${actual}**`);
          }
        }
      }

      // Generate prompt and validate structure
      if (!patterns.error) {
        const data = { examples: t.input, boilerplates: [], customRules: '', patterns };
        prompt = PromptGenerator.generate(data);

        if (t.output_should_contain) {
          for (const fragment of t.output_should_contain) {
            if (!prompt.includes(fragment)) {
              fails.push(`❌ Output missing: \`${fragment}\``);
            }
          }
        }
      }

      if (fails.length === 0) {
        reportLines.push(`✅ **${t.name}**`);
        passCount++;
      } else {
        failCount++;
        reportLines.push(`### ⚠️ ${t.name}\n`);
        if (t.description) reportLines.push(`${t.description}\n`);
        reportLines.push(fails.map(f => `- ${f}`).join('\n'));
      }
    } catch (err) {
      failCount++;
      reportLines.push(`💥 **${t.name}** — Exception: ${err.message}`);
    }
    reportLines.push("");
  }

  reportLines.push(`---\n### 🧾 Summary\n- Passed: **${passCount}**\n- Failed: **${failCount}**\n- Total: ${passCount + failCount}\n`);

  const mdReport = reportLines.join("\n");
  out.textContent = mdReport;
  dlBtn.disabled = false;

  dlBtn.onclick = () => {
    const blob = new Blob([mdReport], { type: "text/markdown" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `prompt-generator-test-report-${new Date().toISOString().split('T')[0]}.md`;
    a.click();
    URL.revokeObjectURL(url);
  };
}

document.getElementById('runTestsBtn').addEventListener('click', runTests);
</script>