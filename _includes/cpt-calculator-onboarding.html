<!-- CPT E/M Calculator Onboarding Modal -->
<div class="onboarding-overlay" id="cptCalculatorOnboarding">
    <div class="onboarding-modal large">
        <button class="onboarding-close" onclick="closeOnboarding('cptCalculatorOnboarding')" aria-label="Close">&times;</button>

        <div class="onboarding-content">
            <!-- Progress Dots -->
            <div class="onboarding-progress">
                <span class="onboarding-progress-dot active"></span>
                <span class="onboarding-progress-dot"></span>
                <span class="onboarding-progress-dot"></span>
            </div>

            <!-- Step 1: Welcome -->
            <div class="onboarding-step active">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 3rem; height: 3rem; color: var(--color-primary);">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75V18m-7.5-6.75h.008v.008H8.25v-.008zm0 2.25h.008v.008H8.25V13.5zm0 2.25h.008v.008H8.25v-.008zm0 2.25h.008v.008H8.25V18zm2.498-6.75h.007v.008h-.007v-.008zm0 2.25h.007v.008h-.007V13.5zm0 2.25h.007v.008h-.007v-.008zm0 2.25h.007v.008h-.007V18zm2.504-6.75h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V13.5zm0 2.25h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V18zm2.498-6.75h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V13.5zM8.25 6h7.5v2.25h-7.5V6zM12 2.25c-1.892 0-3.758.11-5.593.322C5.307 2.7 4.5 3.65 4.5 4.757V19.5a2.25 2.25 0 002.25 2.25h10.5a2.25 2.25 0 002.25-2.25V4.757c0-1.108-.806-2.057-1.907-2.185A48.507 48.507 0 0012 2.25z" />
                    </svg>
                    <h2 style="margin: 0;">Welcome to the E/M Calculator!</h2>
                </div>

                <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">
                    Calculate appropriate CPT E/M codes with automated medical decision making assessment and time-based coding support.
                </p>

                <div class="onboarding-feature-grid">
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 2.5rem; height: 2.5rem;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <h4>2 of 3 MDM Rule</h4>
                        <p>Automatic assessment based on problems, data, and risk</p>
                    </div>
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 2.5rem; height: 2.5rem;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <h4>Time-Based Coding</h4>
                        <p>Built-in stopwatch for accurate time tracking</p>
                    </div>
                    <div class="onboarding-feature">
                        <div class="onboarding-feature-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 2.5rem; height: 2.5rem;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.436 60.436 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.905 59.905 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0112 13.489a50.702 50.702 0 017.74-3.342M6.75 15a.75.75 0 100-1.5.75.75 0 000 1.5zm0 0v-3.675A55.378 55.378 0 0112 8.443m-7.007 11.55A5.981 5.981 0 006.75 15.75v-1.5" />
                            </svg>
                        </div>
                        <h4>Well Visit Support</h4>
                        <p>Handles preventive care visits with modifier -25 guidance</p>
                    </div>
                </div>

                <div class="onboarding-actions">
                    <button class="onboarding-btn onboarding-btn-primary" onclick="nextOnboardingStep('cptCalculatorOnboarding')">
                        Learn How It Works
                    </button>
                    <button class="onboarding-btn onboarding-btn-text" onclick="completeOnboarding('cptCalculatorOnboarding')">
                        Skip tour
                    </button>
                </div>
            </div>

            <!-- Step 2: How It Works -->
            <div class="onboarding-step">
                <h2>How the Calculator Works</h2>
                <p>Follow these simple steps to calculate your E/M code:</p>

                <div style="display: grid; gap: 1.5rem; margin: 2rem 0;">
                    <div style="display: flex; gap: 1.5rem; align-items: start;">
                        <div style="flex-shrink: 0; width: 3rem; height: 3rem; background: var(--color-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.25rem;">1</div>
                        <div>
                            <h4 style="margin: 0 0 0.5rem 0;">Select Patient Type</h4>
                            <p style="margin: 0; color: #7f8c8d;">Choose "New Patient" or "Established Patient" at the top</p>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1.5rem; align-items: start;">
                        <div style="flex-shrink: 0; width: 3rem; height: 3rem; background: var(--color-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.25rem;">2</div>
                        <div>
                            <h4 style="margin: 0 0 0.5rem 0;">Add Well Visit (Optional)</h4>
                            <p style="margin: 0; color: #7f8c8d;">Select preventive care age category if this is a wellness visit</p>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1.5rem; align-items: start;">
                        <div style="flex-shrink: 0; width: 3rem; height: 3rem; background: var(--color-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.25rem;">3</div>
                        <div>
                            <h4 style="margin: 0 0 0.5rem 0;">Complete MDM Assessment</h4>
                            <p style="margin: 0; color: #7f8c8d;">Select items in each of the 3 categories:</p>
                            <ul style="margin: 0.5rem 0 0 1.5rem; color: #7f8c8d;">
                                <li><strong>Problems:</strong> Complexity of conditions addressed</li>
                                <li><strong>Data:</strong> Records reviewed and tests ordered</li>
                                <li><strong>Risk:</strong> Medications, procedures, and clinical decisions</li>
                            </ul>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1.5rem; align-items: start;">
                        <div style="flex-shrink: 0; width: 3rem; height: 3rem; background: var(--color-primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.25rem;">4</div>
                        <div>
                            <h4 style="margin: 0 0 0.5rem 0;">Track Time (Optional)</h4>
                            <p style="margin: 0; color: #7f8c8d;">Use the auto-running stopwatch or manually enter encounter time for time-based coding alternative</p>
                        </div>
                    </div>
                </div>

                <div style="background: #e8f4f8; padding: 1.5rem; border-radius: 12px; border: 2px solid var(--color-primary);">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 1.75rem; height: 1.75rem; color: var(--color-primary);">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                        </svg>
                        <h4 style="margin: 0; color: var(--color-primary);">The "2 of 3" Rule</h4>
                    </div>
                    <p style="margin: 0;">
                        The calculator uses the 2 of 3 MDM rule: your E/M level is determined by meeting the requirements in <strong>2 out of 3 categories</strong> (Problems, Data, or Risk). The result shows automatically as you make selections.
                    </p>
                </div>

                <div class="onboarding-actions">
                    <button class="onboarding-btn onboarding-btn-secondary" onclick="prevOnboardingStep('cptCalculatorOnboarding')">
                        Back
                    </button>
                    <button class="onboarding-btn onboarding-btn-primary" onclick="nextOnboardingStep('cptCalculatorOnboarding')">
                        Continue
                    </button>
                </div>
            </div>

            <!-- Step 3: Tips -->
            <div class="onboarding-step">
                <h2>Pro Tips for Accurate Coding</h2>

                <div style="display: grid; gap: 1.5rem; margin: 2rem 0;">
                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 2rem; height: 2rem; color: var(--color-primary);">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <h4 style="margin: 0;">Time-Based vs MDM-Based</h4>
                        </div>
                        <p style="margin: 0; color: #7f8c8d;">
                            You can bill using either time OR medical decision making - choose whichever gives you the higher level code. The calculator shows both options when applicable.
                        </p>
                    </div>

                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 2rem; height: 2rem; color: var(--color-primary);">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
                            </svg>
                            <h4 style="margin: 0;">Modifier -25 with Well Visits</h4>
                        </div>
                        <p style="margin: 0; color: #7f8c8d;">
                            When billing both a well visit AND an E/M code for a separate problem, append modifier -25 to the E/M code. The calculator shows this guidance automatically.
                        </p>
                    </div>

                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 2rem; height: 2rem; color: var(--color-primary);">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                            </svg>
                            <h4 style="margin: 0;">Document What You Select</h4>
                        </div>
                        <p style="margin: 0; color: #7f8c8d;">
                            Make sure your clinical documentation supports every item you select in the calculator. Auditors will review your notes to verify your billing choices.
                        </p>
                    </div>

                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 2rem; height: 2rem; color: var(--color-primary);">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
                            </svg>
                            <h4 style="margin: 0;">Use the Stopwatch</h4>
                        </div>
                        <p style="margin: 0; color: #7f8c8d;">
                            The stopwatch starts automatically when you load the page. Pause it during interruptions and use "Use Stopwatch Time" to transfer the accurate time to your calculation.
                        </p>
                    </div>
                </div>

                <div style="text-align: center; background: linear-gradient(135deg, var(--color-primary) 0%, #0066aa 100%); color: white; padding: 2rem; border-radius: 12px;">
                    <h3 style="margin-top: 0; color: white;">Ready to Calculate Your E/M Codes?</h3>
                    <p style="margin-bottom: 0; opacity: 0.9;">Start selecting your encounter details and watch the code calculate automatically!</p>
                </div>

                <div class="onboarding-actions">
                    <button class="onboarding-btn onboarding-btn-secondary" onclick="prevOnboardingStep('cptCalculatorOnboarding')">
                        Back
                    </button>
                    <button class="onboarding-btn onboarding-btn-primary" onclick="completeOnboarding('cptCalculatorOnboarding')">
                        Start Calculating
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Initialize CPT calculator onboarding when page loads
document.addEventListener('DOMContentLoaded', function() {
    OnboardingSystem.init('cptCalculatorOnboarding', {
        totalSteps: 3,
        localStorageKey: 'ppe_cpt_calculator_completed',
        showOnce: true,
        delay: 800, // Show after 800ms
        onComplete: function() {
            console.log('CPT Calculator onboarding completed');
        }
    });
});
</script>
