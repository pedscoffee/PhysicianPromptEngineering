<!-- Cookie Consent Banner -->
<div id="cookie-consent-banner" style="display: none; position: fixed; bottom: 0; left: 0; right: 0; background: rgba(31, 41, 55, 0.98); color: white; padding: 1.5rem; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 9999; backdrop-filter: blur(10px);">
  <div class="container" style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; gap: 1.5rem; flex-wrap: wrap;">
    <div style="flex: 1; min-width: 300px;">
      <p style="margin: 0 0 0.5rem 0; font-size: 1rem; font-weight: 600; color: white;">
        üç™ We use cookies
      </p>
      <p style="margin: 0; font-size: 0.875rem; color: #d1d5db; line-height: 1.5;">
        We use Google Analytics cookies to understand how visitors use our site and improve your experience. No personal health information is collected.
        <a href="{{ site.baseurl }}/privacy-policy" style="color: #60a5fa; text-decoration: underline;">Learn more</a>
      </p>
    </div>
    <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
      <button onclick="acceptCookies()" style="background: #2563eb; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: background 0.2s; font-size: 0.875rem; white-space: nowrap;">
        Accept All
      </button>
      <button onclick="declineCookies()" style="background: transparent; color: #d1d5db; border: 1px solid #4b5563; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 0.875rem; white-space: nowrap;">
        Decline
      </button>
    </div>
  </div>
</div>

<script>
  // Cookie consent functionality
  (function() {
    const CONSENT_COOKIE = 'ppe_cookie_consent';
    const CONSENT_DURATION = 365; // days

    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }

    function setCookie(name, value, days) {
      const expires = new Date(Date.now() + days * 864e5).toUTCString();
      document.cookie = `${name}=${value}; expires=${expires}; path=/; SameSite=Lax`;
    }

    function showBanner() {
      const banner = document.getElementById('cookie-consent-banner');
      if (banner) {
        banner.style.display = 'block';
      }
    }

    function hideBanner() {
      const banner = document.getElementById('cookie-consent-banner');
      if (banner) {
        banner.style.display = 'none';
      }
    }

    window.acceptCookies = function() {
      setCookie(CONSENT_COOKIE, 'accepted', CONSENT_DURATION);
      hideBanner();

      // Initialize Google Analytics if not already loaded
      if (typeof gtag === 'function') {
        gtag('consent', 'update', {
          'analytics_storage': 'granted'
        });
      }
    };

    window.declineCookies = function() {
      setCookie(CONSENT_COOKIE, 'declined', CONSENT_DURATION);
      hideBanner();

      // Disable Google Analytics
      if (typeof gtag === 'function') {
        gtag('consent', 'update', {
          'analytics_storage': 'denied'
        });
      }

      // Set ga-disable property to prevent tracking
      window['ga-disable-{{ site.google_analytics }}'] = true;
    };

    // Check consent status on page load
    document.addEventListener('DOMContentLoaded', function() {
      const consent = getCookie(CONSENT_COOKIE);

      if (!consent) {
        // No consent recorded, show banner
        showBanner();
      } else if (consent === 'declined') {
        // User declined, disable analytics
        window['ga-disable-{{ site.google_analytics }}'] = true;
      }
      // If consent === 'accepted', analytics will load normally
    });
  })();
</script>

<style>
  /* Hover effects for cookie consent buttons */
  #cookie-consent-banner button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  #cookie-consent-banner button:first-of-type:hover {
    background: #1e40af;
  }

  #cookie-consent-banner button:last-of-type:hover {
    background: rgba(75, 85, 99, 0.2);
    border-color: #6b7280;
    color: white;
  }

  /* Mobile responsive */
  @media (max-width: 768px) {
    #cookie-consent-banner > div {
      flex-direction: column;
      align-items: stretch;
    }

    #cookie-consent-banner button {
      width: 100%;
    }
  }
</style>
